class Vulnerability < ApplicationRecord
  belongs_to :scan
  has_one :user, through: :scan

  validates :file_path, presence: true
  validates :vulnerability_type, presence: true
  validates :severity, presence: true

  enum severity: {
    low: "low",
    medium: "medium",
    high: "high",
    critical: "critical"
  }

  VULNERABILITY_TYPES = [
    "SQL Injection",
    "Stored XSS",
    "Reflected XSS",
    "Remote Code Execution",
    "CSRF",
    "Broken Access Control",
    "Arbitrary File Upload",
    "Arbitrary File Read",
    "Arbitrary File Write",
    "Arbitrary File Delete",
    "Local File Inclusion",
    "PHP Object Injection",
    "SSRF",
    "Open Redirect",
    "Race Condition",
    "Type Juggling",
    "Sensitive Data Exposure"
  ].freeze

  scope :by_severity, ->(severity) { where(severity: severity) }
  scope :by_type, ->(type) { where(vulnerability_type: type) }
  scope :critical_and_high, -> { where(severity: [ "critical", "high" ]) }
end
